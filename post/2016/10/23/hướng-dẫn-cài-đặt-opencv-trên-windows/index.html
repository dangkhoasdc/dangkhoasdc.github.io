<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hướng dẫn cài đặt OpenCV trên Windows | My blog</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/logs/">Logs</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
      
    
    
    <li><a href="http://dangkhoasdc.github.io/en/post/2016/10/23/install-the-opencv-library-on-visual-studio/">en</a></li>
    


    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Hướng dẫn cài đặt OpenCV trên Windows</span></h1>

<h2 class="date">2016/10/23</h2>
</div>

<main>


<h2 id="biên-dịch-thư-viện-opencv">Biên dịch thư viện OpenCV</h2>

<p>Điểm thuận lợi của việc tự cài đặt và biên dịch thư viện có thể kể đến như sau:</p>

<ol>
<li>Hỗ trợ IDE mới nhất, như trong bản OpenCV 3.0 (22/11/2015) thì chưa có bản biên dịch sẵn dành cho VS 2015.</li>
<li>Customize được các thư viện khác liên quan như Kinect, OpenCL, Python…</li>
</ol>

<p><a href="http://downloads.sourceforge.net/project/opencvlibrary/opencv-win/3.0.0/opencv-3.0.0.exe?r=http%3A%2F%2Fopencv.org%2F&amp;ts=1448134045&amp;use_mirror=nchc">Link Download thư viện OpenCV cho HĐH Windows</a></p>

<p>Bước 1: Giải nén thư viện vào thư mục được định sẵn. Giả sử đường dẫn của mã nguồn là <code>C:\opencv</code></p>

<p><img src="http://i.imgur.com/rwpgj0b.png" alt="Giải nén mã nguồn thư viện OpenCV" /> Bước 2: Tải và cài đặt <a href="https://cmake.org/files/v3.4/cmake-3.4.0-win32-x86.exe">CMake</a>. Thư mục <code>build</code> chứa những tập tin của phần mã nguồn được biên dịch sẵn. Phần <code>sources</code> được sử dụng cho cài đặt manual.</p>

<p><img src="http://i.imgur.com/iFzMg6J.png" alt="Danh sách thư mục OpenCV" /></p>

<p>Bước 3: Mở CMake. Trong phần <code>Where is the source code</code> sẽ trỏ đến thư mục <code>sources</code> đã đề cập lúc trước. Phần <code>Where to build the binaries</code> là nơi chứa phần thư viện được biên dịch. Trong ví dụ này đường dẫn là <code>C:\opencv\sources\build</code>.</p>

<p><img src="http://i.imgur.com/BGpSwUO.png" alt="Giao diện CMake" /></p>

<p>Bước tiếp theo nhấn Configure, sau đó chọn bộ generator cho project, trong phần này sẽ chọn tương ứng với IDE/Compiler mà mã nguồn mình sử dụng. Đồng thời, nếu máy tính đang ở kiến trúc x86 thì chọn các phiên bản IDE với tùy chọn là x86 (Ví dụ Visual Studio 14 2015). Đối với các máy tính kiến trúc x64 thì chọn phiên bản có hậu tố là Win64. Nhấn Finish để kết thúc cấu hình.</p>

<p>Sau khi configure xong thì danh sách các tùy chọn khi biên dịch để hiện ra với rất nhiều tùy biến đi kèm. Phần này trong tutorial này sẽ bỏ qua vì mục tiêu chỉ cần cài đặt bộ thư viện ở mức mặc định là thành công rồi. Nếu không có gì thay đổi ta nhấn chọn Generate.</p>

<p>Sau khi quá trình phát sinh mã nguồn hoàn tất, trong thư mục build sẽ xuất hiện các Project/Solution khác nhau.</p>

<p>Bước 4: Dùng Visual Studio để mở solution có tên là OPENCV. Lưu ý: khi bản VS này phải trùng với bản VS đã configure trong cmake.</p>

<p><img src="http://i.imgur.com/nfvzGPb.png" alt="Target và Architecture của Visual Studio" /></p>

<p>Quá trình biên dịch cần thực hiện qua 2 bước: (1) biên dịch thư viện cho quá trình Debug và (2) biên dịch chương trình trong quá trình Release. Để thực hiện các bước này đơn giản chỉ cần click chọn Target sẽ build rồi sau đó nhấn F7 và ngồi đợi (Mất khoàng 10-15 phút cho quá trình biên dịch trên Debug/Release). Kết quả trong quá trình biên dịch sẽ có khoảng 50 projects biên dịch thành công, 17 cái bị skip và 2 cái bị fail. Sau khi biên dịch, ta sẽ có 2 thư mục cần quan tâm nằm trong build. Đó là thư mục lib chứa toàn bộ dữ liệu cần thiết cho quá trình lập trình; thư mục là dữ liệu cần thiết để chương trình sau khi build có thể chạy được.</p>

<h2 id="cấu-hình-opencv-trên-visual-studio">Cấu hình Opencv trên Visual Studio</h2>

<p>Bước 1: Tạo một Project (Empty Project).</p>

<p><img src="http://i.imgur.com/OR6H08N.png" alt="Tạo Empty Project" /></p>

<p>Trước khi thực hiện tiếp các công việc cấu hình cho project. Ta cần xác định rõ sẽ cần cấu hình những thông tin gì:</p>

<ol>
<li>Nơi chứa header file của OpenCV. Dĩ nhiên ta cần làm điều này để include các đối tượng, hàm… của OpenCV.</li>
<li>Cấu hình các file cần thiết khi lập trình.</li>
<li>Cấu hình các file cần thiết cho quá trình thực thi. Bởi trong Visual Studio có 2 target khi run bao gồm Debug và Release, nên ta cần phải cấu hình riêng biệt cho mỗi target đó.</li>
</ol>

<h3 id="cấu-hình-header-file">Cấu hình header file</h3>

<p>Click chuột phải vào tên project (InstallOpencv) chọn Properties (Hoặc nhấn Alt + F7).</p>

<p><img src="http://i.imgur.com/GB9Dd20.png" alt="Config additional header file" /></p>

<p>Phía bên phần Sidebar chọn C/C++, General, mục Additional Include Directories ta trỏ đến thư mục <code>opencv\build\include</code> (không phải <del><code>sources\build\include</code></del>). Để đảm bảo ta có thể check bằng cách kiểm tra xem thư mục include đó có các header file không. Xong nhấn OK.</p>

<h3 id="cấu-hình-thư-viện-cho-quá-trình-lập-trình">Cấu hình thư viện cho quá trình lập trình</h3>

<p>Nhấn Alt + F7 để vào phần Properties của Project. Chọn Thẻ Linker, mục <code>Additional Library Directories</code> ta trỏ đến thư mục <code>lib\Debug</code> (trong ví dụ này là: <code>C:\opencv\sources\build\lib\Debug</code>). Vì đang cấu hình cho target là Debug nên phần Configuration phải là Debug</p>

<p><img src="http://i.imgur.com/kAG7ftJ.png" alt="Configuration" /> <img src="http://i.imgur.com/QBpuB7C.png" alt="Libs" /> Chuyển đến thẻ Input, mục Additional Dependencies ta nhập các file sau:</p>

<pre><code>opencv_calib3d300d.lib
opencv_core300d.lib
opencv_features2d300d.lib
opencv_flann300d.lib
opencv_hal300d.lib
opencv_highgui300d.lib
opencv_imgcodecs300d.lib
opencv_imgproc300d.lib
opencv_ml300d.lib
opencv_objdetect300d.lib
opencv_photo300d.lib
opencv_shape300d.lib
opencv_stitching300d.lib
opencv_superres300d.lib
opencv_ts300d.lib
opencv_video300d.lib
opencv_videoio300d.lib
opencv_videostab300d.lib
</code></pre>

<p>Sau khi cấu hình xong, ta chuyển qua target là Release và thực hiện giống hệt như vậy. Tuy nhiên đường dẫn lần này sẽ là <code>C:\opoencv\sources\build\lib\Release</code>.</p>

<p>Phần Additional Dependencies sẽ là:</p>

<pre><code>opencv_calib3d300.lib
opencv_core300.lib
opencv_features2d300.lib
opencv_flann300.lib
opencv_hal300.lib
opencv_highgui300.lib
opencv_imgcodecs300.lib
opencv_imgproc300.lib
opencv_ml300.lib
opencv_objdetect300.lib
opencv_photo300.lib
opencv_shape300.lib
opencv_stitching300.lib
opencv_superres300.lib
opencv_ts300.lib
opencv_video300.lib
opencv_videoio300.lib
opencv_videostab300.lib
</code></pre>

<h3 id="cấu-hình-thư-viện-cho-quá-trình-thực-thi">Cấu hình thư viện cho quá trình thực thi</h3>

<p>Khi thực hiện build 1 chương trình, VS sẽ tạo ra trong thư mục của Solution hai thư mục với cấu trúc như sau: <code>\Debug</code> và <code>\Release</code>. Trong ví dụ này là x64\Debug, x64\Release. Ta chép toàn bộ file trong build\bin\Debug vào x64\Debug, tương tự như vậy đối với build\bin\Release và x64\Release.</p>

<p>Tạo một file cpp và run thử chương trình.</p>

<p>Mã nguồn:</p>

<pre><code class="language-cpp">#include &lt;opencv2/opencv.hpp&gt;
#include &lt;iostream&gt;
using namespace cv;
using namespace std;

int main() {
    Mat img = imread(&quot;demo.jpg&quot;);
    imshow(&quot;show image&quot;, img);
    waitKey(0);
    destroyAllWindows();
}
</code></pre>

<p>(Với mã nguồn này lưu ý đặt 1 file tên là <code>demo.jpg</code> vào trong thư mục chứa mã nguồn).</p>

<p><img src="http://i.imgur.com/CtRS1r5.png" alt="Demo" /></p>

<p>Kết quả ta được như hình trên.</p>

<h2 id="tuy-nhiên">Tuy nhiên</h2>

<p>Có một chữ tuy nhiên to đùng như vậy vì với cách cấu hình thế này có khá là nhiều bất cập:</p>

<ol>
<li>Mỗi lần tạo 1 project OpenCV mới mà ngồi config (Mục 2) thì cũng rất là mất thời gian. Chưa kể trong lúc cấu hình mà quên mất một công đoạn nào thì có khi đi tong cả buổi chỉ để fix lỗi.</li>
<li>Những file trong sources\bin\Debug hay Release đều xấp xỉ 900MB. Vị chi mỗi lần chép qua bên project thì tốn thêm 1.8GB bộ nhớ. Chỉ cần trong máy chứa dăm ba project dùng OpenCV thì sẽ ngốn dung lượng đến chừng nào.</li>
<li>Phần Additional Dependencies mỗi phiên bản OpenCV mỗi khác, làm thế nào để lấy được danh sách các file như thế này.</li>
</ol>

<p>Ta sẽ giải quyết từ dễ đến khó trước.</p>

<h3 id="additional-dependencies">Additional Dependencies</h3>

<p>Sau khi biên dịch xong thư viện ta mở Command Line và trỏ đến thư mục <code>sources\build\lib</code></p>

<p>Gõ lệnh sau</p>

<pre><code>dir Debug\*d.lib /B &gt;..\DependenciesDebug.txt
dir Release\*.lib /B &gt;..\DependenciesRelease.txt

</code></pre>

<p>Sau khi gõ xong thì trong thư mục build sẽ xuất hiện 2 file text là DependenciesDebug và DependenciesRelease chứa danh sách tât cả các file libs. Mỗi lần sử dụng chỉ cần mở file lên và chép vào.</p>

<h3 id="lib-configuration">Lib Configuration</h3>

<p>Mở Command Line (Với quyền Admin - click chuột phải vào biểu tượng Start và chọn Command Promp) và gõ lệnh</p>

<pre><code> setx -m OPENCV_DIR C:\opencv
</code></pre>

<p>Nhấn <code>Windows E</code> để mở File Explorer</p>

<p><img src="http://i.imgur.com/8tTY60w.png" alt="Windows Explorer" /></p>

<p>Click vào Computer và chọn Properties</p>

<p><img src="http://i.imgur.com/NKnfVzz.png" alt="Advanced System Settings" /></p>

<p>Chọn Advanced system settings. Trong thẻ Advanced chọn Environment Variables…</p>

<p><img src="http://i.imgur.com/HdUETeV.png" alt="Path Variable Config" /></p>

<p>Điền ngay phía sau của phần Variable value giá trị sau: <code>%OPENCV_DIR%\sources\build\bin\Debug;%OPENCV_DIR%\sources\build\bin\Release</code></p>

<p>Xong, và từ giờ trở đi ta không cần phải chép các file trong build\bin vào trong project nữa.</p>

<h3 id="sao-lưu-config-của-project">Sao lưu config của project</h3>

<p>Trong sidebar Property Manager ta thấy danh sách các config tương ứng với từng target
architecture trong project.</p>

<p><img src="http://i.imgur.com/UrkPyJs.png" alt="Property Manager" /></p>

<p>Ta sẽ tạo một Property Sheet mới (Click chuột phải vào từng mục và chọn Add New Project Property Sheet…), double click vào mục mới tạo và cấu hình giống hệt với mục 2. Sau đó lưu lại. VS sẽ tạo ra 1 file có định dạng props trong project. Sau này khi tạo ra 1 project mới ta chỉ cần import Property đã tạo mà không cần config lại từ đầu.</p>

<p>Vì đã set OPENCV_DIR là thư mục của OpenCV nên ta có thể thay đổi đường dẫn của các config thành</p>

<pre><code>    %OPENCV_DIR%\build\include
    %OPENCV_DIR%\source\build\lib\Debug
    %OPENCV_DIR%\source\build\lib\Release

</code></pre>

</main>

  <footer>
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
onload='renderMathInElement(document.body,{
  delimiters: [
      {left: "$$", right: "$$", display: true},
      {left: "\\[", right: "\\]", display: true},
      {left: "$", right: "$", display: false},
      {left: "\\(", right: "\\)", display: false}
  ]});'></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-2381283-3', 'auto');
	
	ga('send', 'pageview');
}
</script>

<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "httpdangkhoasdcgithubio" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  
  <hr/>
  &copy; <a href="https://dkhoa.dev">Dang-Khoa</a> 2017 &ndash; 2019 | <a href="https://github.com/dangkhoasdc">Github</a> | <a href="https://twitter.com/dksdc">Twitter</a>
  
  </footer>
  </body>
</html>

